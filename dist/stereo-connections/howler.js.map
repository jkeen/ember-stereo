{"version":3,"file":"howler.js","sources":["../../src/stereo-connections/howler.js"],"sourcesContent":["import { makeArray } from '@ember/array';\nimport BaseSound from './base';\nimport { waitFor } from '@ember/test-waiters';\n\n/**\n* This is the connection class that uses Howler to play sounds.\n*\n* @class Howler\n* @constructor\n* @extensionfor Base\n\n*/\nexport default class Howler extends BaseSound {\n  static key = 'Howler';\n\n  static toString() {\n    return 'Howler';\n  }\n\n  setup() {\n    let urls = makeArray(this.url);\n    let sound = this;\n    let options = Object.assign({\n      src: urls,\n      autoplay: false,\n      preload: true,\n      html5: true,\n      volume: 1,\n      onload: function () {\n        sound.url = this._src;\n        sound.howl = this;\n        sound.trigger('audio-loaded', { sound });\n        sound.trigger('audio-ready', { sound });\n      },\n      onpause: function () {\n        // if (!sound.isPlaying) {\n        sound.trigger('audio-paused', { sound });\n        // }\n      },\n      onplay: function () {\n        sound.trigger('audio-played', { sound });\n      },\n      onend: function () {\n        sound.trigger('audio-ended', { sound });\n      },\n      onstop: function () {\n        sound.trigger('audio-paused', { sound });\n      },\n      onloaderror: function (id, code) {\n        var MEDIA_NOT_ALLOWED = 0;\n        var MEDIA_ERR_ABORTED = 1;\n        var MEDIA_ERR_NETWORK = 2;\n        var MEDIA_ERR_DECODE = 3;\n        var MEDIA_ERR_SRC_NOT_SUPPORTED = 4;\n\n        if (code === MEDIA_NOT_ALLOWED) {\n          sound.trigger('audio-blocked', {\n            sound,\n            error:\n              'Audio autoplay attempt was blocked by browser user settings',\n          });\n        } else {\n          let message = '';\n          switch (code) {\n            case MEDIA_ERR_ABORTED:\n              message = 'You aborted the audio playback.';\n              break;\n            case MEDIA_ERR_NETWORK:\n              message = 'A network error caused the audio download to fail.';\n              break;\n            case MEDIA_ERR_DECODE:\n              message = 'Decoder error.';\n              break;\n            case MEDIA_ERR_SRC_NOT_SUPPORTED:\n              message = 'Audio source format is not supported.';\n              break;\n            default:\n              message = 'Audio load error';\n              break;\n          }\n\n          sound.trigger('audio-load-error', { sound, error: message });\n        }\n      },\n      onseek: function () {\n        sound.trigger('audio-position-changed', { sound });\n      },\n    });\n\n    if (this.options.xhr) {\n      options.xhr = {\n        withCredentials: this.options.xhr?.withCredentials || false,\n        headers: this.options.xhr?.headers || {},\n        method: this.options.xhr?.method || 'GET',\n      };\n    }\n\n    this.loadHowler().then(({ Howl }) => {\n      this.howl = new Howl(options);\n    });\n  }\n\n  teardown() {\n    if (this.howl) {\n      this.howl.unload();\n    }\n    super.teardown();\n  }\n\n  get audioElement() {\n    let sounds = this.howl?._sounds;\n\n    if (sounds && sounds.length > 0) {\n      let element = sounds[0]._node;\n      if (element) {\n        element.setAttribute('crossorigin', 'anonymous');\n        element.setAttribute('preload', 'metadata');\n        return element;\n      }\n    }\n\n    return undefined;\n  }\n\n  _audioDuration() {\n    return this.howl?.duration() * 1000;\n  }\n\n  _currentPosition() {\n    return this.howl?.seek() * 1000;\n  }\n\n  _setPosition(position) {\n    this.howl?.seek(position / 1000);\n    return this._currentPosition();\n  }\n\n  _setVolume(volume) {\n    this.howl?.volume(volume / 100);\n  }\n\n  play({ position } = {}) {\n    if (!this.howl.playing()) {\n      this.isLoading = true;\n      this.debug('#play');\n      if (typeof position !== 'undefined') {\n        this.position = position;\n      }\n      this.howl.play();\n    }\n  }\n\n  pause() {\n    this.debug('#pause');\n    this.howl.pause();\n  }\n\n  stop() {\n    this.debug('#stop');\n    this.howl.stop();\n  }\n\n  @waitFor\n  loadHowler() {\n    return import('howler')\n      .then((module) => module.default)\n      .then((mod) => {\n        return Promise.resolve({\n          Howl: mod.Howl,\n        });\n      });\n  }\n}\n"],"names":["Howler","_class","_class2","BaseSound","toString","setup","urls","makeArray","url","sound","options","Object","assign","src","autoplay","preload","html5","volume","onload","_src","howl","trigger","onpause","onplay","onend","onstop","onloaderror","id","code","MEDIA_NOT_ALLOWED","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","error","message","onseek","xhr","withCredentials","headers","method","loadHowler","then","Howl","teardown","unload","audioElement","sounds","_sounds","length","element","_node","setAttribute","undefined","_audioDuration","duration","_currentPosition","seek","_setPosition","position","_setVolume","play","playing","isLoading","debug","pause","stop","module","default","mod","Promise","resolve","_defineProperty","_applyDecoratedDescriptor","prototype","waitFor","getOwnPropertyDescriptor"],"mappings":"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"}