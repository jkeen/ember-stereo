{"version":3,"file":"stereo-volume.js","sources":["../../src/modifiers/stereo-volume.js"],"sourcesContent":["/**\n * This is the modifier used to transform an range control into a volume control\n * ```hbs\n  <input type=\"range\" {{stereo-volume}}>\n  </input>\n  ```\n *\n  @class {{stereo-volume}}\n  @type Modifier\n*/\n\nimport { registerDestructor } from '@ember/destroyable';\nimport { action } from '@ember/object';\nimport { inject as service } from '@ember/service';\nimport Modifier from 'ember-modifier';\nexport default class StereoVolumeModifier extends Modifier {\n  @service stereo;\n  element = null;\n\n  constructor() {\n    super(...arguments);\n    registerDestructor(this, this.unregisterListeners.bind(this));\n  }\n\n  @action\n  handleTap(e) {\n    window.requestAnimationFrame(() => {\n      e.preventDefault();\n      var rect = this.element.getBoundingClientRect();\n      // Check if the event is a touch event\n      let x;\n      if (e.type === 'touchmove') {\n        x = e.touches[0].clientX - rect.left; // x position within the element for touch event\n      } else {\n        x = e.clientX - rect.left; // x position within the element for mouse click\n      }\n      let volumeLevel = parseInt((x / rect.width) * 100, 10);\n      this.setVolume(volumeLevel)\n    })\n  }\n\n  @action\n  onRangeChange(event) {\n    this.setVolume(parseInt(event.target.value, 10))\n    event.preventDefault();\n  }\n\n  setVolume(volume) {\n    this.stereo.volume = Math.max(0, Math.min(100, volume))\n  }\n\n  @action\n  updateRangeValue(volume) {\n    this.element.value = volume;\n  }\n\n  isDragging = false;\n\n  @action\n  handleDragStart() {\n    this.isDragging = true;\n    return false;\n  }\n\n  @action\n  handleDragEnd() {\n    this.isDragging = false;\n    return false;\n  }\n\n  @action\n  handleDrag(event) {\n    if (!this.isDragging) {\n      return;\n    }\n    this.handleTap(event);\n  }\n\n  modify(element, [eventName], options) {\n    if (!this.element) {\n      this.element = element;\n      this.eventName = eventName;\n      this.options = options;\n      this.isRangeControl =\n        element.tagName?.toLowerCase() === 'input' &&\n        element.type?.toLowerCase() === 'range';\n\n      if (this.isRangeControl) {\n        this.element.setAttribute('max', 100);\n        this.element.setAttribute('min', 0);\n        this.element.addEventListener('change', this.onRangeChange);\n        this.element.addEventListener('input', this.onRangeChange);\n        this.element.value = this.stereo.volume;\n        this.stereo.on('volume-change', this.updateRangeValue);\n      } else {\n        this.element.addEventListener('click', this.handleTap);\n        this.element.addEventListener('tap', this.handleTap);\n\n        this.element.addEventListener('drag', this.handleDrag);\n        this.element.addEventListener('mousemove', this.handleDrag);\n        this.element.addEventListener('touchmove', this.handleDrag);\n\n        this.element.addEventListener('dragstart', this.handleDragStart);\n        this.element.addEventListener('mousedown', this.handleDragStart);\n        this.element.addEventListener('touchstart', this.handleDragStart);\n\n        this.element.addEventListener('dragend', this.handleDragEnd);\n        document.addEventListener('mouseup', this.handleDragEnd);\n        document.addEventListener('touchend', this.handleDragEnd);\n\n        document.addEventListener('mousemove', this.handleDrag);\n        document.addEventListener('touchmove', this.handleDrag);\n      }\n    }\n  }\n\n  unregisterListeners() {\n    if (this.isRangeControl) {\n      this.element.removeEventListener('change', this.onChange, true);\n      this.element.removeEventListener('input', this.onRangeChange);\n      this.stereo.off('volume-change', this.updateRangeValue);\n    } else {\n      this.element.removeEventListener('click', this.handleTap);\n      this.element.removeEventListener('tap', this.handleTap);\n\n      this.element.removeEventListener('drag', this.handleDrag);\n      this.element.removeEventListener('mousemove', this.handleDrag);\n      this.element.removeEventListener('touchmove', this.handleDrag);\n\n      this.element.removeEventListener('dragstart', this.handleDragStart);\n      this.element.removeEventListener('mousedown', this.handleDragStart);\n      this.element.removeEventListener('touchstart', this.handleDragStart);\n\n      this.element.removeEventListener('dragend', this.handleDragEnd);\n      document.removeEventListener('mouseup', this.handleDragEnd);\n      document.removeEventListener('touchend', this.handleDragEnd);\n\n      document.removeEventListener('mousemove', this.handleDrag);\n      document.removeEventListener('touchmove', this.handleDrag);\n    }\n  }\n}\n"],"names":["StereoVolumeModifier","_class","Modifier","constructor","arguments","_initializerDefineProperty","_descriptor","_defineProperty","registerDestructor","unregisterListeners","bind","handleTap","e","window","requestAnimationFrame","preventDefault","rect","element","getBoundingClientRect","x","type","touches","clientX","left","volumeLevel","parseInt","width","setVolume","onRangeChange","event","target","value","volume","stereo","Math","max","min","updateRangeValue","handleDragStart","isDragging","handleDragEnd","handleDrag","modify","eventName","options","isRangeControl","tagName","toLowerCase","setAttribute","addEventListener","on","document","removeEventListener","onChange","off","_applyDecoratedDescriptor","prototype","service","configurable","enumerable","writable","initializer","action","Object","getOwnPropertyDescriptor"],"mappings":"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"}