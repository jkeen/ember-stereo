{"version":3,"file":"object-cache.js","sources":["../../../src/-private/utils/object-cache.js"],"sourcesContent":["import { tracked } from '@glimmer/tracking';\nimport { inject as service } from '@ember/service';\nimport normalizeIdentifier from './normalize-identifier';\nimport { TrackedObject, TrackedWeakMap } from 'tracked-built-ins';\nimport { makeArray } from '@ember/array';\n\nfunction isAnObject(identifier) {\n  return (\n    identifier !== undefined &&\n    identifier !== null &&\n    (typeof identifier === 'object' || identifier.then)\n  );\n}\n\n/**\n * This class caches things based on a strings or objects. You shouldn't have to interact with this class.\n * @class ObjectCache\n */\nexport default class ObjectCache {\n  @service stereo; // used by subclasses\n\n  @tracked objectCache = new TrackedWeakMap();\n  @tracked keyCache = new TrackedObject();\n  name = 'ember-stereo:object-cache';\n\n  has(idOrIds) {\n    let id = makeArray(idOrIds).find((id) => {\n      return this._has(id);\n    });\n\n    return this._has(id);\n  }\n\n  find(idOrIds) {\n    let id = makeArray(idOrIds).find((id) => {\n      return this._find(id);\n    });\n\n    return this._find(id);\n  }\n\n  remove(idOrIds) {\n    return makeArray(idOrIds).forEach((id) => {\n      return this._remove(id);\n    });\n  }\n\n  store(idOrIds, value) {\n    return makeArray(idOrIds).forEach((id) => {\n      return this._store(id, value);\n    });\n  }\n\n  _has(_identifier) {\n    let identifier = normalizeIdentifier(_identifier);\n    if (isAnObject(identifier)) {\n      return this.objectCache.has(identifier);\n    } else {\n      return identifier in this.keyCache;\n    }\n  }\n\n  _find(_identifier) {\n    let identifier = normalizeIdentifier(_identifier);\n\n    if (isAnObject(identifier) && this.objectCache.has(identifier)) {\n      return this.objectCache.get(identifier);\n    } else if (this.keyCache[identifier]) {\n      return this.keyCache[identifier];\n    }\n  }\n\n  _remove(_identifier) {\n    let identifier = normalizeIdentifier(_identifier);\n\n    if (isAnObject(identifier) && this.objectCache.has(identifier)) {\n      this.objectCache.delete(identifier);\n    }\n    if (this.keyCache[identifier]) {\n      delete this.keyCache[identifier];\n    }\n  }\n\n  _store(_identifier, value) {\n    let identifier = normalizeIdentifier(_identifier);\n\n    if (identifier) {\n      if (isAnObject(identifier)) {\n        this.objectCache.set(identifier, value);\n      } else {\n        this.keyCache[identifier] = value;\n      }\n    }\n  }\n}\n"],"names":["isAnObject","identifier","undefined","then","ObjectCache","_class","constructor","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_defineProperty","has","idOrIds","id","makeArray","find","_has","_find","remove","forEach","_remove","store","value","_store","_identifier","normalizeIdentifier","objectCache","keyCache","get","delete","set","_applyDecoratedDescriptor","prototype","service","configurable","enumerable","writable","initializer","tracked","TrackedWeakMap","TrackedObject"],"mappings":"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"}