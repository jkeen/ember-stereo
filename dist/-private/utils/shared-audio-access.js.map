{"version":3,"file":"shared-audio-access.js","sources":["../../../src/-private/utils/shared-audio-access.js"],"sourcesContent":["import debug from 'debug';\nconst log = debug('ember-stereo:shared-audio-access');\n\n/**\n * This class handles sharing a single audio element between multiple sounds.\n * A desktop browser can generally handle multiple `audio` elements, but mobile\n * browsers require some extra consideration. Using a single element and switching\n * out the src allows us to play a piece of audio seamlessly without requiring\n * an extra click by the user to get around strict autoplay restrictions\n *\n * Note from late 2023:\n * The above was true in 2016-2017, but not sure if it still stands. Apparently using\n * a single element also solved some WNYC-specific issues with adswizz not allowing multiple\n * connections at once (as documented in the changelog for 1.6.0). But again, not sure if that's\n * worth keeping something that significantly complicates the codebase.\n *\n * @private\n * @class SharedAudioAccess\n */\n/*\n\n */\nexport default class SharedAudioAccess {\n  audioElement;\n  owner;\n\n  debug(message) {\n    log(message);\n  }\n\n  unlock(andPlay) {\n    if (!this.audioElement) {\n      this.debug('creating new audio element');\n      let audioElement = SharedAudioAccess.createElement();\n      this.audioElement = audioElement;\n\n      if (andPlay) {\n        this.debug(`telling blank audio element to play`);\n        audioElement.play();\n      }\n    }\n    return this;\n  }\n\n  requestControl(who) {\n    let owner = this.owner;\n\n    if (owner !== who && owner) {\n      who.debug('[shared-audio-access] I need audio control');\n      this.debug('coordinating peaceful transfer of power');\n    }\n\n    if (owner) {\n      owner.releaseControl();\n      if (owner !== who && owner) {\n        owner.debug(\"[shared-audio-access] I've released audio control\");\n      }\n    }\n\n    this.owner = who;\n    if (owner !== who) {\n      who.debug('[shared-audio-access] I have control now');\n    }\n    return this.audioElement;\n  }\n\n  hasControl(who) {\n    return this.owner === who;\n  }\n\n  releaseControl(who) {\n    if (this.hasControl(who)) {\n      this.owner = null;\n    }\n  }\n\n  _reset() {\n    this.owner = null;\n    this.audioElement = null;\n  }\n\n  static createElement() {\n    let audio = document.createElement('audio');\n    audio.setAttribute('preload', 'metadata');\n    audio.setAttribute('id', new Date().getTime());\n\n    return audio;\n  }\n}\n"],"names":["log","debug","SharedAudioAccess","constructor","_defineProperty","message","unlock","andPlay","audioElement","createElement","play","requestControl","who","owner","releaseControl","hasControl","_reset","audio","document","setAttribute","Date","getTime"],"mappings":";;;AACA,MAAMA,GAAG,GAAGC,KAAK,CAAC,kCAAkC,CAAC,CAAA;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,MAAMC,iBAAiB,CAAC;EAAAC,WAAA,GAAA;IAAAC,eAAA,CAAA,IAAA,EAAA,cAAA,EAAA,KAAA,CAAA,CAAA,CAAA;IAAAA,eAAA,CAAA,IAAA,EAAA,OAAA,EAAA,KAAA,CAAA,CAAA,CAAA;AAAA,GAAA;EAIrCH,KAAKA,CAACI,OAAO,EAAE;IACbL,GAAG,CAACK,OAAO,CAAC,CAAA;AACd,GAAA;EAEAC,MAAMA,CAACC,OAAO,EAAE;AACd,IAAA,IAAI,CAAC,IAAI,CAACC,YAAY,EAAE;AACtB,MAAA,IAAI,CAACP,KAAK,CAAC,4BAA4B,CAAC,CAAA;AACxC,MAAA,IAAIO,YAAY,GAAGN,iBAAiB,CAACO,aAAa,EAAE,CAAA;MACpD,IAAI,CAACD,YAAY,GAAGA,YAAY,CAAA;AAEhC,MAAA,IAAID,OAAO,EAAE;AACX,QAAA,IAAI,CAACN,KAAK,CAAE,CAAA,mCAAA,CAAoC,CAAC,CAAA;QACjDO,YAAY,CAACE,IAAI,EAAE,CAAA;AACrB,OAAA;AACF,KAAA;AACA,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEAC,cAAcA,CAACC,GAAG,EAAE;AAClB,IAAA,IAAIC,KAAK,GAAG,IAAI,CAACA,KAAK,CAAA;AAEtB,IAAA,IAAIA,KAAK,KAAKD,GAAG,IAAIC,KAAK,EAAE;AAC1BD,MAAAA,GAAG,CAACX,KAAK,CAAC,4CAA4C,CAAC,CAAA;AACvD,MAAA,IAAI,CAACA,KAAK,CAAC,yCAAyC,CAAC,CAAA;AACvD,KAAA;AAEA,IAAA,IAAIY,KAAK,EAAE;MACTA,KAAK,CAACC,cAAc,EAAE,CAAA;AACtB,MAAA,IAAID,KAAK,KAAKD,GAAG,IAAIC,KAAK,EAAE;AAC1BA,QAAAA,KAAK,CAACZ,KAAK,CAAC,mDAAmD,CAAC,CAAA;AAClE,OAAA;AACF,KAAA;IAEA,IAAI,CAACY,KAAK,GAAGD,GAAG,CAAA;IAChB,IAAIC,KAAK,KAAKD,GAAG,EAAE;AACjBA,MAAAA,GAAG,CAACX,KAAK,CAAC,0CAA0C,CAAC,CAAA;AACvD,KAAA;IACA,OAAO,IAAI,CAACO,YAAY,CAAA;AAC1B,GAAA;EAEAO,UAAUA,CAACH,GAAG,EAAE;AACd,IAAA,OAAO,IAAI,CAACC,KAAK,KAAKD,GAAG,CAAA;AAC3B,GAAA;EAEAE,cAAcA,CAACF,GAAG,EAAE;AAClB,IAAA,IAAI,IAAI,CAACG,UAAU,CAACH,GAAG,CAAC,EAAE;MACxB,IAAI,CAACC,KAAK,GAAG,IAAI,CAAA;AACnB,KAAA;AACF,GAAA;AAEAG,EAAAA,MAAMA,GAAG;IACP,IAAI,CAACH,KAAK,GAAG,IAAI,CAAA;IACjB,IAAI,CAACL,YAAY,GAAG,IAAI,CAAA;AAC1B,GAAA;EAEA,OAAOC,aAAaA,GAAG;AACrB,IAAA,IAAIQ,KAAK,GAAGC,QAAQ,CAACT,aAAa,CAAC,OAAO,CAAC,CAAA;AAC3CQ,IAAAA,KAAK,CAACE,YAAY,CAAC,SAAS,EAAE,UAAU,CAAC,CAAA;AACzCF,IAAAA,KAAK,CAACE,YAAY,CAAC,IAAI,EAAE,IAAIC,IAAI,EAAE,CAACC,OAAO,EAAE,CAAC,CAAA;AAE9C,IAAA,OAAOJ,KAAK,CAAA;AACd,GAAA;AACF;;;;"}